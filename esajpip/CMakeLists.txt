
PROJECT(esajpip)

CONFIGURE_FILE(esajpip/server.cfg ${CMAKE_CURRENT_BINARY_DIR}/server.cfg)

SET(ESAJPIP_TOP esajpip/src)
AUX_SOURCE_DIRECTORY(${ESAJPIP_TOP}/data     DATA_SRCS)
AUX_SOURCE_DIRECTORY(${ESAJPIP_TOP}/http     HTTP_SRCS)
AUX_SOURCE_DIRECTORY(${ESAJPIP_TOP}/ipc      IPC_SRCS)
AUX_SOURCE_DIRECTORY(${ESAJPIP_TOP}/jpeg2000 JPEG2000_SRCS)
AUX_SOURCE_DIRECTORY(${ESAJPIP_TOP}/jpip     JPIP_SRCS)
AUX_SOURCE_DIRECTORY(${ESAJPIP_TOP}/net      NET_SRCS)
SET(ALL_SRCS ${DATA_SRCS} ${HTTP_SRCS} ${IPC_SRCS} ${JPEG2000_SRCS} ${JPIP_SRCS} ${NET_SRCS})

SET(CORE_SRCS
	base.cc
    trace.cc
	app_info.cc
	app_config.cc
	args_parser.cc
	client_info.cc
	client_manager.cc)

FOREACH(SRC ${CORE_SRCS})
    SET(APP_SRCS ${APP_SRCS} ${ESAJPIP_TOP}/${SRC})
ENDFOREACH(SRC)

ADD_DEFINITIONS(-D_NO_READPROC -D_NO_FAST_FILE -pthread -DNDEBUG -DLOG4CPP_HAVE_SSTREAM)

IF(CMAKE_SYSTEM_NAME STREQUAL "Linux")
	ADD_DEFINITIONS(-D_PLATFORM_LINUX)
ENDIF(CMAKE_SYSTEM_NAME STREQUAL "Linux")

IF(UNIX AND NOT APPLE)
	ADD_DEFINITIONS(-D_POSIX_C_SOURCE=200112L -D_XOPEN_SOURCE=600)
	SET(CMAKE_EXE_LINKER_FLAGS "-lrt")
ENDIF(UNIX AND NOT APPLE)

INCLUDE_DIRECTORIES(BEFORE . ${ESAJPIP_TOP} ${LIBCONFIG}/lib ${LOG4CPP}/include)
ADD_EXECUTABLE(esajpip ${ESAJPIP_TOP}/esa_jpip_server.cc ${APP_SRCS} ${ALL_SRCS})

TARGET_LINK_LIBRARIES(esajpip config++ log4cpp pthread)
INSTALL(TARGETS esajpip DESTINATION ".")
INSTALL(FILES ${CMAKE_CURRENT_BINARY_DIR}/server.cfg DESTINATION ".")
